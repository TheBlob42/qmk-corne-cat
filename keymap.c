#include QMK_KEYBOARD_H
#include <stdio.h>

// save some space based on:
// https://github.com/qmk/qmk_firmware/issues/3224#issuecomment-399769416
#define DISABLE_LEADER
#define NO_ACTION_MACRO
#define NO_ACTION_FUNCTION

#define CTL_ESC  LCTL_T(KC_ESC)
#define CTL_QUOT RCTL_T(KC_QUOT)
#define CTL_GRV  LCTL_T(KC_GRV)
#define CTL_BSLS RCTL_T(KC_BSLS)

#define SFT_CAPS  LSFT_T(KC_CAPS)
#define SFT_ENTER RSFT_T(KC_ENTER)

#define LSPACE LT(_NUMBER_1, KC_SPC)
#define RSPACE LT(_NUMBER_2, KC_SPC)

enum corne_layers {
    _DEFAULT,
    _NUMBER_1,
    _NUMBER_2,
    _FN,
    _MOTION,
};

const uint16_t PROGMEM keymaps[][MATRIX_ROWS][MATRIX_COLS] = {
  [_DEFAULT] = LAYOUT_split_3x6_3(
  //,-----------------------------------------------------.                    ,-----------------------------------------------------.
       KC_TAB,    KC_Q,    KC_W,    KC_E,    KC_R,    KC_T,                         KC_Y,    KC_U,    KC_I,    KC_O,   KC_P,  KC_BSPC,
  //|--------+--------+--------+--------+--------+--------|                    |--------+--------+--------+--------+--------+--------|
      CTL_ESC,    KC_A,    KC_S,    KC_D,    KC_F,    KC_G,                         KC_H,    KC_J,    KC_K,    KC_L, KC_SCLN,CTL_QUOT,
  //|--------+--------+--------+--------+--------+--------|                    |--------+--------+--------+--------+--------+--------|
     SFT_CAPS,    KC_Z,    KC_X,    KC_C,    KC_V,    KC_B,                         KC_N,    KC_M, KC_COMM,  KC_DOT, KC_SLSH,SFT_ENTER,
  //|--------+--------+--------+--------+--------+--------+--------|  |--------+--------+--------+--------+--------+--------+--------|
                                          KC_LGUI,   MO(_FN),  LSPACE,     RSPACE,   MO(_MOTION), KC_LALT
                                      //`--------------------------'  `--------------------------'

  ),

  [_NUMBER_1] = LAYOUT_split_3x6_3(
  //,-----------------------------------------------------.                    ,-----------------------------------------------------.
       KC_DEL,    KC_Q, XXXXXXX,    KC_E, XXXXXXX, XXXXXXX,                      XXXXXXX, KC_LBRC, KC_RBRC, KC_MINS,  KC_EQL, KC_BSPC,
  //|--------+--------+--------+--------+--------+--------|                    |--------+--------+--------+--------+--------+--------|
      CTL_GRV,    KC_1,    KC_2,    KC_3,    KC_4,    KC_5,                         KC_6,    KC_7,    KC_8,    KC_9,    KC_0,CTL_BSLS,
  //|--------+--------+--------+--------+--------+--------|                    |--------+--------+--------+--------+--------+--------|
      KC_LSFT, XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX,                      XXXXXXX, XXXXXXX, KC_COMM,  KC_DOT, XXXXXXX, KC_RSFT,
  //|--------+--------+--------+--------+--------+--------+--------|  |--------+--------+--------+--------+--------+--------+--------|
                                          XXXXXXX, XXXXXXX, _______,    KC_RSFT, KC_RGUI, KC_RALT
                                      //`--------------------------'  `--------------------------'
  ),

  [_NUMBER_2] = LAYOUT_split_3x6_3(
  //,-----------------------------------------------------.                    ,-----------------------------------------------------.
       KC_DEL, XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX,                      XXXXXXX, KC_LBRC, KC_RBRC, KC_MINS,  KC_EQL, KC_BSPC,
  //|--------+--------+--------+--------+--------+--------|                    |--------+--------+--------+--------+--------+--------|
      CTL_GRV,    KC_1,    KC_2,    KC_3,    KC_4,    KC_5,                         KC_6,    KC_7,    KC_8,    KC_9,    KC_0,CTL_BSLS,
  //|--------+--------+--------+--------+--------+--------|                    |--------+--------+--------+--------+--------+--------|
      KC_LSFT, XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX,                      XXXXXXX, XXXXXXX, KC_COMM,  KC_DOT, XXXXXXX, KC_RSFT,
  //|--------+--------+--------+--------+--------+--------+--------|  |--------+--------+--------+--------+--------+--------+--------|
                                          KC_LALT, KC_LGUI, KC_LSFT,    _______, XXXXXXX, XXXXXXX
                                      //`--------------------------'  `--------------------------'
  ),

  [_FN] = LAYOUT_split_3x6_3(
  //,-----------------------------------------------------.                    ,-----------------------------------------------------.
      XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX,                      XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX,
  //|--------+--------+--------+--------+--------+--------|                    |--------+--------+--------+--------+--------+--------|
      KC_LCTL,   KC_F1,   KC_F2,   KC_F3,   KC_F4,   KC_F5,                        KC_F6,   KC_F7,   KC_F8,   KC_F9,  KC_F10, KC_RCTL,
  //|--------+--------+--------+--------+--------+--------|                    |--------+--------+--------+--------+--------+--------|
      KC_LSFT, XXXXXXX, XXXXXXX, XXXXXXX,  KC_F11,  KC_F12,                      XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX, XXXXXXX,
  //|--------+--------+--------+--------+--------+--------+--------|  |--------+--------+--------+--------+--------+--------+--------|
                                          XXXXXXX, _______, XXXXXXX,     KC_ENT, KC_LGUI, KC_LALT
                                      //`--------------------------'  `--------------------------'
  ),

  [_MOTION] = LAYOUT_split_3x6_3(
  //,-----------------------------------------------------.                    ,-----------------------------------------------------.
        RESET, XXXXXXX, XXXXXXX, KC_BRID, KC_BRIU, XXXXXXX,                      XXXXXXX, KC_PGUP,   KC_UP, KC_PGDN, XXXXXXX, KC_PSCR,
  //|--------+--------+--------+--------+--------+--------|                    |--------+--------+--------+--------+--------+--------|
      KC_LCTL, KC_MPRV, KC_MPLY, KC_MSTP, KC_MNXT, XXXXXXX,                      KC_HOME, KC_LEFT, KC_DOWN, KC_RGHT, KC_END,  KC_RCTL,
  //|--------+--------+--------+--------+--------+--------|                    |--------+--------+--------+--------+--------+--------|
      KC_LSFT, XXXXXXX, KC_MUTE, KC_VOLD, KC_VOLU, XXXXXXX,                      XXXXXXX, KC_HOME, XXXXXXX,  KC_END, XXXXXXX, XXXXXXX,
  //|--------+--------+--------+--------+--------+--------+--------|  |--------+--------+--------+--------+--------+--------+--------|
                                          KC_LALT, KC_LGUI, KC_LSFT,    XXXXXXX, _______, XXXXXXX
                                      //`--------------------------'  `--------------------------'
  )
};

// ### CAT OLED ANIMATION ###

char wpm_str[10];

// In your rules.mk make sure you have:
// OLED_ENABLE = yes
// WPM_ENABLE = yes

#ifdef OLED_ENABLE

#define IDLE_SPEED 20 // below this wpm value your animation will idle
#define FAST_SPEED 70  // above this wpm value typing animation to trigger
#define ANIM_SIZE 96  // number of bytes in array, minimize for adequate firmware size, max is 1024

#define ANIM_FRAME_DURATION 400  // how long each frame lasts in ms

uint32_t frame_duration = ANIM_FRAME_DURATION;

uint32_t anim_timer = 0;
uint32_t anim_sleep = 0;
uint8_t current_idle_frame = 6;

void oled_render_left_cat(void) {
    static const char PROGMEM cat[6][ANIM_SIZE] = {
        {
            // 'sleep_1', 32x22px
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
            0x80, 0x00, 0x00, 0x40, 0x10, 0x00, 0x40, 0x00, 0x10, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
            0x00, 0x00, 0x00, 0x00, 0xc0, 0x30, 0x10, 0x10, 0x08, 0x08, 0x08, 0x08, 0x08, 0x88, 0x84, 0x23, 
            0x40, 0x43, 0x24, 0x04, 0x04, 0x04, 0x24, 0x44, 0x43, 0x20, 0x03, 0xfc, 0x80, 0x00, 0x00, 0x00, 
            0x00, 0x00, 0x00, 0x0f, 0x10, 0x10, 0x12, 0x12, 0x12, 0x12, 0x14, 0x18, 0x10, 0x12, 0x12, 0x10, 
            0x10, 0x10, 0x10, 0x12, 0x11, 0x12, 0x10, 0x10, 0x10, 0x10, 0x08, 0x07, 0x02, 0x00, 0x00, 0x00
        },
        {
            // 'sleep_2', 32x22px
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xc0, 
            0x20, 0xc0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xc0, 0x20, 0xc0, 0x00, 0x00, 0x00, 0x00, 0x00, 
            0x00, 0x00, 0x00, 0x80, 0x40, 0x38, 0x04, 0x04, 0x02, 0x02, 0x02, 0x02, 0x02, 0x42, 0x41, 0x10, 
            0x20, 0x20, 0x11, 0x01, 0x81, 0x01, 0x11, 0x21, 0x20, 0x10, 0x00, 0xff, 0x40, 0x00, 0x00, 0x00, 
            0x00, 0x00, 0x00, 0x0f, 0x10, 0x10, 0x12, 0x12, 0x12, 0x12, 0x14, 0x18, 0x10, 0x11, 0x11, 0x10, 
            0x10, 0x10, 0x10, 0x11, 0x10, 0x11, 0x10, 0x10, 0x10, 0x10, 0x0c, 0x07, 0x01, 0x00, 0x00, 0x00
        },
        {
            // 'walk_1', 32x22px
            0x00, 0x00, 0xf0, 0x08, 0x04, 0xe2, 0x11, 0x09, 0x09, 0x06, 0x00, 0x00, 0x00, 0x00, 0xc0, 0x30, 
            0x08, 0x30, 0x40, 0x40, 0x40, 0x40, 0x40, 0x40, 0x30, 0x08, 0x30, 0xc0, 0x00, 0x00, 0x00, 0x00, 
            0x00, 0x00, 0x01, 0x02, 0xfc, 0x00, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x14, 0x14, 
            0x00, 0x02, 0x00, 0x00, 0x00, 0x08, 0x04, 0x08, 0x00, 0x02, 0x40, 0xa0, 0x1f, 0x14, 0x00, 0x00, 
            0x00, 0x00, 0x00, 0x00, 0x0f, 0x10, 0x10, 0x0c, 0x14, 0x14, 0x0c, 0x04, 0x04, 0x04, 0x04, 0x04, 
            0x04, 0x0c, 0x10, 0x10, 0x08, 0x04, 0x04, 0x04, 0x08, 0x10, 0x10, 0x0f, 0x00, 0x00, 0x00, 0x00
        },
        {
            // 'walk_2', 32x22px
            0x00, 0x00, 0xe0, 0x10, 0x08, 0xc4, 0x22, 0x12, 0x12, 0x0c, 0x00, 0x00, 0x00, 0x00, 0x80, 0x60, 
            0x10, 0x60, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x60, 0x10, 0x60, 0x80, 0x00, 0x00, 0x00, 0x00, 
            0x00, 0x00, 0x03, 0x04, 0xf8, 0x01, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x29, 0x28, 
            0x00, 0x04, 0x00, 0x00, 0x00, 0x10, 0x08, 0x10, 0x00, 0x04, 0x80, 0x41, 0x3e, 0x28, 0x00, 0x00, 
            0x00, 0x00, 0x0c, 0x12, 0x11, 0x10, 0x08, 0x14, 0x14, 0x14, 0x0c, 0x04, 0x04, 0x04, 0x04, 0x04, 
            0x04, 0x04, 0x08, 0x10, 0x10, 0x18, 0x04, 0x04, 0x04, 0x04, 0x08, 0x11, 0x12, 0x0c, 0x00, 0x00
        },
        {
            // 'speeedy_1', 32x22px
            0x00, 0x00, 0xe0, 0x10, 0x08, 0xc4, 0x22, 0x12, 0x12, 0x0c, 0x00, 0x00, 0x00, 0x00, 0x80, 0x60, 
            0x10, 0x60, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x60, 0x10, 0x60, 0x80, 0x00, 0x00, 0x00, 0x00, 
            0x00, 0x00, 0x03, 0x04, 0xf8, 0x01, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x2a, 0x29, 0x00, 
            0x04, 0x0e, 0x04, 0x00, 0x00, 0x10, 0x08, 0x10, 0x04, 0x0e, 0x84, 0x41, 0x3e, 0x28, 0x00, 0x00, 
            0x00, 0x00, 0x00, 0x0e, 0x11, 0x10, 0x08, 0x14, 0x14, 0x0c, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 
            0x04, 0x04, 0x08, 0x10, 0x10, 0x08, 0x04, 0x04, 0x04, 0x08, 0x10, 0x11, 0x0e, 0x00, 0x00, 0x00
        },
        {
            // 'speeedy_2', 32x22px
            0xc0, 0x20, 0x20, 0x20, 0x40, 0x40, 0x80, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
            0xc0, 0x30, 0x08, 0x30, 0x40, 0x40, 0x40, 0x40, 0x40, 0x40, 0x30, 0x08, 0x30, 0xc0, 0x00, 0x00, 
            0x00, 0x01, 0x01, 0x02, 0x82, 0x82, 0xfc, 0x00, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x15, 
            0x14, 0x00, 0x02, 0x07, 0x02, 0x00, 0x80, 0x88, 0x84, 0x88, 0x02, 0x07, 0x42, 0xa0, 0x9f, 0x14, 
            0x00, 0x00, 0x00, 0x01, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 
            0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x03, 0x02, 0x02, 0x02, 0x02, 0x01
        },
    };

    if (timer_elapsed32(anim_timer) > frame_duration) {
        anim_timer = timer_read32();
        current_idle_frame = (current_idle_frame + 1) % 2;

        if (get_current_wpm() <= IDLE_SPEED) {
            // "lower" the animation time for the sleeping animation
            frame_duration = ANIM_FRAME_DURATION + 400;
        } else {
            frame_duration = ANIM_FRAME_DURATION;
        }

        if (get_current_wpm() > IDLE_SPEED && get_current_wpm() < FAST_SPEED) {
            current_idle_frame = current_idle_frame + 2;
        }

        if (get_current_wpm() >= FAST_SPEED) {
            current_idle_frame = current_idle_frame + 4;
        }

        oled_write_raw_P(cat[current_idle_frame], 96);
    }
}

void oled_render_right_cat(void) {
    static const char PROGMEM idle_dino[6][ANIM_SIZE] = {
        {
            // 'cat_sleep_1', 32x22px
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x10, 0x00, 0x40, 0x00, 0x10, 0x40, 0x00, 0x00, 0x80, 
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
            0x00, 0x00, 0x00, 0x80, 0xfc, 0x03, 0x20, 0x43, 0x44, 0x24, 0x04, 0x04, 0x04, 0x24, 0x43, 0x40, 
            0x23, 0x84, 0x88, 0x08, 0x08, 0x08, 0x08, 0x08, 0x10, 0x10, 0x30, 0xc0, 0x00, 0x00, 0x00, 0x00, 
            0x00, 0x00, 0x00, 0x02, 0x07, 0x08, 0x10, 0x10, 0x10, 0x10, 0x12, 0x11, 0x12, 0x10, 0x10, 0x10, 
            0x10, 0x12, 0x12, 0x10, 0x18, 0x14, 0x12, 0x12, 0x12, 0x12, 0x10, 0x10, 0x0f, 0x00, 0x00, 0x00
        },
        {
            // 'cat_sleep_2', 32x22px
            0x00, 0x00, 0x00, 0x00, 0x00, 0xc0, 0x20, 0xc0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xc0, 0x20, 
            0xc0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
            0x00, 0x00, 0x00, 0x40, 0xff, 0x00, 0x10, 0x20, 0x21, 0x11, 0x01, 0x81, 0x01, 0x11, 0x20, 0x20, 
            0x10, 0x41, 0x42, 0x02, 0x02, 0x02, 0x02, 0x02, 0x04, 0x04, 0x38, 0x40, 0x80, 0x00, 0x00, 0x00, 
            0x00, 0x00, 0x00, 0x01, 0x07, 0x0c, 0x10, 0x10, 0x10, 0x10, 0x11, 0x10, 0x11, 0x10, 0x10, 0x10, 
            0x10, 0x11, 0x11, 0x10, 0x18, 0x14, 0x12, 0x12, 0x12, 0x12, 0x10, 0x10, 0x0f, 0x00, 0x00, 0x00
        },
        {
            // 'cat_stand', 32x22px
            0x00, 0x00, 0x00, 0x00, 0xc0, 0x30, 0x08, 0x30, 0x40, 0x40, 0x40, 0x40, 0x40, 0x40, 0x30, 0x08, 
            0x30, 0xc0, 0x00, 0x00, 0x00, 0x00, 0x06, 0x09, 0x09, 0x11, 0xe2, 0x04, 0x08, 0xf0, 0x00, 0x00, 
            0x00, 0x00, 0x14, 0x1f, 0xa0, 0x40, 0x02, 0x00, 0x08, 0x04, 0x08, 0x00, 0x00, 0x00, 0x02, 0x00, 
            0x14, 0x14, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x00, 0xfc, 0x02, 0x01, 0x00, 0x00, 
            0x00, 0x00, 0x00, 0x00, 0x0f, 0x10, 0x10, 0x08, 0x04, 0x04, 0x04, 0x08, 0x10, 0x10, 0x0c, 0x04, 
            0x04, 0x04, 0x04, 0x04, 0x04, 0x0c, 0x14, 0x14, 0x0c, 0x10, 0x10, 0x0f, 0x00, 0x00, 0x00, 0x00
        },
        {
            // 'cat_walk', 32x22px
            0x00, 0x00, 0x00, 0x00, 0x80, 0x60, 0x10, 0x60, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x60, 0x10, 
            0x60, 0x80, 0x00, 0x00, 0x00, 0x00, 0x0c, 0x12, 0x12, 0x22, 0xc4, 0x08, 0x10, 0xe0, 0x00, 0x00, 
            0x00, 0x00, 0x28, 0x3e, 0x41, 0x80, 0x04, 0x00, 0x10, 0x08, 0x10, 0x00, 0x00, 0x00, 0x04, 0x00, 
            0x28, 0x29, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x01, 0xf8, 0x04, 0x03, 0x00, 0x00, 
            0x00, 0x00, 0x0c, 0x12, 0x11, 0x08, 0x04, 0x04, 0x04, 0x04, 0x18, 0x10, 0x10, 0x08, 0x04, 0x04, 
            0x04, 0x04, 0x04, 0x04, 0x04, 0x0c, 0x14, 0x14, 0x14, 0x08, 0x10, 0x11, 0x12, 0x0c, 0x00, 0x00
        },
        {
            // 'speeedy_1', 32x22px
            0x00, 0x00, 0x00, 0x00, 0x80, 0x60, 0x10, 0x60, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x60, 0x10, 
            0x60, 0x80, 0x00, 0x00, 0x00, 0x00, 0x0c, 0x12, 0x12, 0x22, 0xc4, 0x08, 0x10, 0xe0, 0x00, 0x00, 
            0x00, 0x00, 0x28, 0x3e, 0x41, 0x84, 0x0e, 0x04, 0x10, 0x08, 0x10, 0x00, 0x00, 0x04, 0x0e, 0x04, 
            0x00, 0x29, 0x2a, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x01, 0xf8, 0x04, 0x03, 0x00, 0x00, 
            0x00, 0x00, 0x00, 0x0e, 0x11, 0x10, 0x08, 0x04, 0x04, 0x04, 0x08, 0x10, 0x10, 0x08, 0x04, 0x04, 
            0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x0c, 0x14, 0x14, 0x08, 0x10, 0x11, 0x0e, 0x00, 0x00, 0x00
        },
        {
            // 'speeedy_2', 32x22px
            0x00, 0x00, 0xc0, 0x30, 0x08, 0x30, 0x40, 0x40, 0x40, 0x40, 0x40, 0x40, 0x30, 0x08, 0x30, 0xc0, 
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x80, 0x40, 0x40, 0x20, 0x20, 0x20, 0xc0, 
            0x14, 0x9f, 0xa0, 0x42, 0x07, 0x02, 0x88, 0x84, 0x88, 0x80, 0x00, 0x02, 0x07, 0x02, 0x00, 0x14, 
            0x15, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x00, 0xfc, 0x82, 0x82, 0x02, 0x01, 0x01, 0x00, 
            0x01, 0x02, 0x02, 0x02, 0x02, 0x03, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 
            0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x01, 0x00, 0x00, 0x00
        },
    };

    if (timer_elapsed32(anim_timer) > frame_duration) {
        anim_timer = timer_read32();
        current_idle_frame = (current_idle_frame + 1) % 2;

        if (get_current_wpm() <= IDLE_SPEED) {
            // "lower" the animation time for the sleeping animation
            frame_duration = ANIM_FRAME_DURATION + 400;
        } else {
            frame_duration = ANIM_FRAME_DURATION;
        }

        if (get_current_wpm() > IDLE_SPEED && get_current_wpm() < FAST_SPEED) {
            current_idle_frame = current_idle_frame + 2;
        }

        if (get_current_wpm() >= FAST_SPEED) {
            current_idle_frame = current_idle_frame + 4;
        }

        oled_write_raw_P(idle_dino[current_idle_frame], 96);
    }
}

oled_rotation_t oled_init_user(oled_rotation_t rotation) {
    return OLED_ROTATION_270;
}

bool oled_task_user(void) {
    if (get_current_wpm() > 0) {
        oled_on();
        anim_sleep = timer_read32();
    } else if (timer_elapsed32(anim_sleep) > OLED_TIMEOUT) {
        oled_clear(); // to prevent screen flickering on modifiers etc.
        oled_off();
        return false;
    }

    if (is_keyboard_master()) {
        oled_write("-----", false);
        oled_write("\n", false);
        oled_write("DON'T", false);
        oled_write("\n", false);
        oled_write("_____", false);

        led_t led_state = host_keyboard_led_state();

        // the layer state is not updated on the secondary side, so we can only react to it on the primary
        // display the key placement for the thumb clusters (since I sometimes can't remember those)
        // for the default layer its just used as a capslock indicator
        switch (get_highest_layer(layer_state)) {
            case _DEFAULT:
                oled_write("\n", false);
                oled_write("\n", false);
                oled_write(led_state.caps_lock ? "CPSLK" : "\n", false);
                oled_write("\n", false);
                break;
            case _NUMBER_1:
                oled_write("\n", false);
                oled_write(" SFT\n", false);
                oled_write(" GUI\n", false);
                oled_write(" ALT\n", false);
                break;
            case _NUMBER_2:
                oled_write("\n", false);
                oled_write(" ALT\n", false);
                oled_write(" GUI\n", false);
                oled_write(" SFT\n", false);
                break;
            case _FN:
                oled_write("\n", false);
                oled_write(" RET\n", false);
                oled_write(" GUI\n", false);
                oled_write(" ALT\n", false);
                break;
            case _MOTION:
                oled_write("\n", false);
                oled_write(" ALT\n", false);
                oled_write(" GUI\n", false);
                oled_write(" SFT\n", false);
                break;
            default:
                oled_write("UNDEF", false);
                oled_write("\n", false);
                oled_write("\n", false);
                oled_write("\n", false);
        }

        // some spacing
        oled_write("\n", false);
        oled_write("\n", false);
        
        oled_render_left_cat();
    } else {
        oled_write("-----", false);
        oled_write("\n", false);
        oled_write("PANIC", false);
        oled_write("\n", false);
        oled_write("-----", false);

        uint8_t n = get_current_wpm();
        char wpm_str[4];
        wpm_str[3] = '\0';
        wpm_str[2] = '0' + n % 10;
        wpm_str[1] = '0' + (n /= 10) % 10;
        wpm_str[0] = '0' + n / 10;

        oled_write("\n", false);
        oled_write(" ", false);
        oled_write(wpm_str, false);
        oled_write("\n", false);
        oled_write(" WPM\n", false);
        oled_write("\n", false);

        // some spacing
        oled_write("\n", false);
        oled_write("\n", false);

        oled_render_right_cat();
    }

    return false;
}
#endif
